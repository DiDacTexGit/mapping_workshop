<!DOCTYPE html>
<html>
    <head>
        <title>Web Mapping Workshop - Lotlinker Data</title>

        <link rel="stylesheet" href="../lib/leaflet-0.7/leaflet.css" />
        <link rel="stylesheet" href="../lib/leaflet.markercluster/MarkerCluster.css" />
        <link rel="stylesheet" href="../lib/leaflet.markercluster/MarkerCluster.Default.css" />
        <link rel="stylesheet" href="../styles/reset.css" />
        <link rel="stylesheet" href="../styles/workshop.css" />
    </head>
    <body>
        <!-- Navigation Start -->
        <nav class="navigation">
            <ul>
                <li><a href="../tutorial/00_introductions.html">Introductions</a></li>
                <li><a href="../tutorial/01_intro2mapping.html">Introduction to Web Mapping</a></li>
                <li><a href="../tutorial/02_intro2leaflet.html">Introduction to Leaflet</a></li>
                <li><a href="../tutorial/03_devenv.html">Development Environment</a></li>
                <li><a href="../tutorial/10_hellomap.html">Making a Map</a></li>
                <li><a href="../tutorial/11_tilesources.html">Base Maps</a></li>
                <li><a href="../tutorial/20_markers.html">Markers</a></li>
                <li><a href="../tutorial/21_popups.html">Pop Ups</a><li>
                <li><a href="../tutorial/30_geojson.html">GeoJSON</a></li>
                <li><a href="../tutorial/40_markercluster.html">Plugins - Marker Clustering</a></li>
                <li><a href="../tutorial/41_awesomemarkers.html">Plugins - Awesome Markers</a></li>
                <li><a href="../tutorial/42_draw.html">Plugins - Draw</a></li>
            </ul>
            <hr />
            <ul>
                <li><a href="../explore/cfd.html">Civic Hacking &amp; Code for Dayton</a></li>
                <li>
                    <a href="../explore/index.html">Further Explorations</a>
                    <ul>
                        <li><a class="selected" href="../explore/lotlinker.html">LotLinker</a></li>
                        <li><a href="../explore/neighborhoods.html">Neighborhoods</a></li>
                        <li><a href="../explore/esri.html">ESRI Data</a></li>
                        <li><a href="../explore/airports.html">Airports</a></li>
                        <li><a href="../explore/college.html">Colleges</a></li>
                        <li><a href="../explore/earthquake.html">Earthquakes</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
        <!-- Navigation End -->

        <section class="content">
            <h1>Property Data from Lotlinker</h1>
            <div id="mapid" style="width: 100%; height: 400px"></div>
            <h2>Description</h2>
            <p>This is a custom-built dataset created by Code For Dayton. It powers <a href="http://www.lotlinker.com/">LotLinker</a> and <a href="http://gogetproperties.com/">Go Get Properties</a>. Here is the <a href="https://github.com/codefordayton/scrapers">scraper</a> that collects the data, and here is the <a href="https://github.com/codefordayton/daytonreap/blob/master/scripts/buildjson.py">script</a> that builds the JSON file that is parsed for the site.</p>
            <p>The complete Go Get Properties and LotLinker sites are more complicated that the map on this page. The actual sites provide searching and filtering, custom markers, and interactions between map components and other parts of the page. The code is a bit rough, but it still provides a good example for how these things can be done.</p>
            <h2>Data Source</h2>
            <p>It is a multi-step process to create the data set for this application:</p>
            <ul>
                <li>Start with Montgomery County's monthly <a href="http://www.mctreas.org/filedownloads.cfm">delinquent property list</a>.</li>
                <li>The reap scraper filters out records from the csv, and supplements the data with information scraped from the <a href="http://www.mctreas.org/">County Treasurer's site</a>.</li>
                <li>It is then split between city of Dayton records (LotLinker) and county records (Go Get Properties) with the split_reap_items.py script.</li>
                <li>Each record is geocoded via our custom geocoder<a href="#geocoder">*</a>, filtered for 'REAPability', and converted to JSON by the appropriate project's build_json.py script.</li>
                <li>The output is copied into the static/data folder for each web server.</li>
            </ul>
            <p id="geocoder">Geocoding is an important topic in web mapping, especially if you have data that does not contain lat/lon coordinates. We chose to build our own, since some of the data was missing complete addresses. Using the county's <a href="http://www.mcauditor.org/downloads/gis_download_shape.cfm">GIS data</a>, we could key off the parcel ids instead of street address. The work of building the geocoder is split between the scraper's init_parcel_centroid.py script, and the individual build_json.py scripts. Building something like this is outside the scope of the workshop, but we'd be happy to talk you through the process we used.</p>

            <p>There are several free or free-ish geocoders available that work on normal address data. The <a href="http://geocoding.geo.census.gov/">U.S. Census Bureau</a> provides one, as does <a href="https://developers.google.com/maps/documentation/geocoding/start">Google</a>. Each has its benefits and drawbacks.</p>

            <h2>Enhancements</h2>
            <p>As mentioned earlier, the code written for LotLinker and Go Get Properties is a bit rough, and it could use some improvements. If you are interested in helping out, please let us know!

            <h2>Resources</h2>
            <ul>
                <li><a href="http://scrapy.org/">Scrapy</a>, our web scraper of choice.</li>
            </ul>
        </section>

        <script src="../lib/leaflet-0.7/leaflet.js"></script>
        <script src="../lib/leaflet.markercluster/leaflet.markercluster-src.js"></script>
        <script src="data/lotlinker.json"></script>
        <script>

            var mymap = L.map('mapid').setView([39.758948, -84.191607], 11);

            L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw', {
                maxZoom: 18,
                attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
                    '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                    'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
                id: 'mapbox.streets'
            }).addTo(mymap);

            function formatPopup(props) {
                return '<h3>' + props.street + '</h3>' +
                       '<p>Parcel ID: <a href="http://www.mctreas.org/master.cfm?parid=' +
                           props.parcelid.replace(" ", "%20") +
                           '&taxyr=2015&own1=SMITH">' + props.parcelid + '</a></p>' +
                           '<p>Claimed: ' + (props.claimed ? "Yes" : "No") + '</p>' +
                           '<a href="' + props.url + '">Details</a>';
            }

            var markerList = [];
            for (var i = 0; i < points.length; i++) {
                var a = points[i];
                var title = a.street;
                var marker = L.marker(L.latLng(parseFloat(a.lat), parseFloat(a.lon)), { title: title});

                marker.bindPopup(formatPopup(a));
                markerList.push(marker);
            }

            markers = L.markerClusterGroup();
            markers.addLayers(markerList);
            mymap.addLayer(markers);

        </script>
    </body>
</html>
