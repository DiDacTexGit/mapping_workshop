<!DOCTYPE html>
<html>
    <head>
        <title>Web Mapping Workshop - Earthquake Data from USGS</title>

        <link rel="stylesheet" href="../lib/leaflet-0.7/leaflet.css" />
        <link rel="stylesheet" href="../styles/reset.css" />
        <link rel="stylesheet" href="../styles/workshop.css" />
    </head>
<body>
    <!-- Navigation Start -->
    <nav class="navigation">
        <ul>
            <li><a href="../tutorial/00_introductions.html">Introductions</a></li>
            <li><a href="../tutorial/01_intro2mapping.html">Introduction to Web Mapping</a></li>
            <li><a href="../tutorial/02_intro2leaflet.html">Introduction to Leaflet</a></li>
            <li><a href="../tutorial/03_devenv.html">Development Environment</a></li>
            <li><a href="../tutorial/10_hellomap.html">Making a Map</a></li>
            <li><a href="../tutorial/11_tilesources.html">Base Maps</a></li>
            <li><a href="../tutorial/20_markers.html">Markers</a></li>
            <li><a href="../tutorial/21_popups.html">Pop Ups</a><li>
            <li><a href="../tutorial/30_geojson.html">GeoJSON</a></li>
            <li><a href="../tutorial/40_markercluster.html">Plugins - Marker Clustering</a></li>
            <li><a href="../tutorial/41_awesomemarkers.html">Plugins - Awesome Markers</a></li>
        </ul>
        <hr />
        <ul>
            <li><a href="../explore/cfd.html">Civic Hacking &amp; Code for Dayton</a></li>
            <li>
                <a href="../explore/index.html">Further Explorations</a>
                <ul>
                    <li><a href="../explore/lotlinker.html">LotLinker</a></li>
                    <li><a href="../explore/neighborhoods.html">Neighborhoods</a></li>
                    <li><a href="../explore/esri.html">ESRI Data</a></li>
                    <li><a href="../explore/airports.html">Airports</a></li>
                    <li><a href="../explore/college.html">Colleges</a></li>
                    <li><a class="selected" href="../explore/earthquake.html">Earthquakes</a></li>
                </ul>
            </li>
        </ul>
    </nav>
    <!-- Navigation End -->

        <section class="content">
            <h1>Earthquake Data from USGS</h1>
            <div id="mapid" style="width: 100%; height: 400px"></div>
            <h2>Description</h2>
            <p>The United States Geological Survey (USGS) provides several realtime feeds of earthquake occurences. We're using a <a href="http://geojson.org/geojson-spec.html">GeoJSON</a> feed that contains all earthquakes in the past month with a magnitude greater than 2.5. We use this example to demonstrate:</p>
            <ul>
                <li>Consuming a remote GeoJSON data feed that contains data points.</li>
                <li>Custom vector markers that change style based on the data source.</li>
                <li>Styling markers with CSS.</li>
            </ul>

            <h2>Data Source</h2>
            <p>The USGS provide earthquake data in <a href="http://earthquake.usgs.gov/earthquakes/feed/">several formats</a>, with varying refresh frequencies. GeoJSON is the easiest to work with, but any of the other formats could be made to work.</p>

            <p>Like many government agencies, the USGS has a lot of interesting open datasets. Interested in <a href="http://energy.usgs.gov/OtherEnergy/WindEnergy.aspx#4312358-data">Wind turbines</a>? <a href="https://lta.cr.usgs.gov/high_res_ortho">High-resolution, public domain satellite data</a>? There is a lot here. This isn't the best organized resource, but it is worth exploring if you are interested in climate and geological data sets.

            <h2>Enhancements</h2>
            <ul>
                <li>The underlying data feed used here updates every five minutes. Can you make the map do the same? If so, can you highlight the earthquakes that are only in the new set?</li>
                <li>We chose just one of the several feeds for this map. Could you use the layer control functionality to let the user choose which one to see?</li>
                <li>Could you use the <a href="http://earthquake.usgs.gov/earthquakes/feed/v1.0/geojson_detail.php">GeoJSON Detail feed</a> to display more information about the selected event on your map page?</li>
            </ul>

            <h2>Resources</h2>
            <ul>
                <li><a href="http://earthquake.usgs.gov/earthquakes/feed/">The USGS feeds</a></li>
                <li><a href="http://earthquake.usgs.gov/earthquakes/feed/v1.0/geojson.php">The event summary format</a></li>
            </ul>
        </section>

        <script src="../lib/leaflet-0.7/leaflet.js"></script>
        <script src="../lib/leaflet.ajax.js"></script>
        <script>

            var mymap = L.map('mapid').setView([0, 0], 1);

            L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw', {
                maxZoom: 18,
                attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
                    '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                    'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
                id: 'mapbox.streets'
            }).addTo(mymap);

            function formatPopup(props) {
                return '<h3>' + props.place + '</h3>' +
                       '<p>Magnitude: ' + props.mag + '</p>' +
                       '<a href="' + props.url + '">Details</a>';
            }

            function onEachFeature(feature, layer) {
                if (feature.properties && feature.properties.place) {
                    layer.bindPopup(formatPopup(feature.properties));
                }
            }

            var geojsonMarkerOptions = {
                radius: 8,
                fillColor: "#ff7800",
                color: "#000",
                weight: 1,
                opacity: 1,
                fillOpacity: 0.8
            };

            var geojsonLayer = new L.GeoJSON.AJAX(
                "http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/2.5_month.geojson", {
                    onEachFeature: onEachFeature,
                    pointToLayer: function (feature, latlng) {
                    return L.circleMarker(latlng, geojsonMarkerOptions);
                },
                style: function (feature) {
                    if (feature.properties.mag > 6) {
                        return { fillColor: "#ff0000"};
                    } else if (feature.properties.mag > 4) {
                        return { fillColor: "#ff9933"};
                    } else if (feature.properties.mag > 2) {
                        return { fillColor: "#ffff00"};
                    }
                }
            });
            geojsonLayer.addTo(mymap);

        </script>
    </body>
</html>
